#!/bin/bash

# post-checkout hook receives 3 parameters:
# $1: ref of previous HEAD
# $2: ref of new HEAD
# $3: flag - 1 for branch checkout, 0 for file checkout

# ANSI color codes
RED='\033[0;31m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Only proceed if this is a branch checkout (not file checkout)
if [ "$3" != "1" ]; then
    exit 0
fi

# Get the branch we just checked out to
new_branch=$(git rev-parse --abbrev-ref HEAD)

# If we checked out to main, automatically pull
if [ "$new_branch" = "main" ]; then
    # Check for uncommitted changes
    if ! git diff-index --quiet HEAD --; then
        echo -e "${YELLOW}Skipping auto-pull: uncommitted changes detected${NC}"
        echo -e "${YELLOW}Commit or stash your changes, then pull manually${NC}"
        exit 0
    fi

    echo -e "${BLUE}Auto-pulling main branch...${NC}"
    if ! git pull; then
        echo -e "${RED}Warning: Failed to pull latest changes for main branch${NC}"
        echo -e "${RED}Please resolve any issues and pull manually${NC}"
        exit 0
    fi
fi
