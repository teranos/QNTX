#!/usr/bin/env bash
# Pre-commit hook: Auto-update Nix vendorHash when Go dependencies change

set -e

# ANSI color codes
BLUE='\033[0;34m'
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Check if go.mod or go.sum are being committed
if git diff --cached --name-only | grep -qE '^go\.(mod|sum)$'; then
  echo -e "${BLUE}üîß Go dependencies changed, updating Nix vendorHash...${NC}"

  # Run the update script
  if "$(dirname "$0")/update-nix-hash.sh"; then
    # Stage the updated flake.nix
    git add flake.nix
    echo -e "${GREEN}‚úì flake.nix updated and staged${NC}"
  else
    echo -e "${RED}‚ùå Failed to update vendorHash${NC}"
    exit 1
  fi
fi

exit 0
