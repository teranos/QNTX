<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QNTX - pulse-execution-history</title>
  <link rel="icon" type="image/jpeg" href="../qntx.jpg">
  <link rel="stylesheet" href="../css/core.css">
  <link rel="stylesheet" href="../css/docs.css">
</head>
<body>
<nav class="doc-nav">
  <a href="../index.html">
    <img src="../qntx.jpg" alt="QNTX" class="site-logo">Documentation Home
  </a>
</nav>
<h1>Pulse Execution History</h1>
<blockquote>
<p><strong>Related</strong>: <a href="../architecture/pulse-async-ix.html"><code>pulse-async-ix.md</code></a> - Core Pulse architecture</p>
</blockquote>
<h2>Overview</h2>
<p>Execution history tracking for Pulse scheduled jobs, enabling users to view past job runs with logs, timing data, and status information.</p>
<h2>Features</h2>
<ul>
<li><strong>Execution Records</strong>: Track every scheduled job run with unique execution ID</li>
<li><strong>Timing Data</strong>: Start/completion timestamps and duration in milliseconds</li>
<li><strong>Status Tracking</strong>: Running, completed, failed states</li>
<li><strong>Log Capture</strong>: Store execution logs for debugging</li>
<li><strong>Error Tracking</strong>: Capture error messages on failures</li>
<li><strong>Result Summaries</strong>: Brief overview of execution results</li>
</ul>
<h2>Database Schema</h2>
<h3><code>pulse_executions</code> Table</h3>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS pulse_executions (
    id TEXT PRIMARY KEY,                    -- ASID format: PX_{random}_{timestamp}
    scheduled_job_id TEXT NOT NULL,         -- FK to scheduled_jobs(id)
    async_job_id TEXT,                      -- Optional FK to async_jobs(id)

    -- Execution status
    status TEXT NOT NULL,                   -- 'running', 'completed', 'failed'

    -- Timing
    started_at TEXT NOT NULL,               -- RFC3339 timestamp
    completed_at TEXT,                      -- RFC3339 timestamp (null if running)
    duration_ms INTEGER,                    -- Milliseconds (null if running)

    -- Output capture
    logs TEXT,                              -- Captured stdout/stderr
    result_summary TEXT,                    -- Brief summary
    error_message TEXT,                     -- Error if failed

    -- Metadata
    created_at TEXT NOT NULL,               -- RFC3339 timestamp
    updated_at TEXT NOT NULL,               -- RFC3339 timestamp

    FOREIGN KEY (scheduled_job_id) REFERENCES scheduled_jobs(id)
);

CREATE INDEX idx_pulse_executions_job ON pulse_executions(scheduled_job_id);
CREATE INDEX idx_pulse_executions_status ON pulse_executions(status);
CREATE INDEX idx_pulse_executions_started ON pulse_executions(started_at);
</code></pre>
<h2>API Endpoints</h2>
<h3>List Executions</h3>
<pre><code class="language-http">GET /api/pulse/jobs/{job_id}/executions?limit=50&amp;offset=0&amp;status=completed
</code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json">{
  "executions": [
    {
      "id": "PX_abc123_1733450123",
      "scheduled_job_id": "SPJ_1733450000",
      "status": "completed",
      "started_at": "2025-12-06T02:00:00Z",
      "completed_at": "2025-12-06T02:00:12Z",
      "duration_ms": 12340,
      "result_summary": "Processed successfully",
      "error_message": null
    }
  ],
  "count": 1,
  "total": 47,
  "has_more": true
}
</code></pre>
<blockquote>
<p><strong>Type Reference</strong>: See <a href="../types/schedule.md#execution">Execution</a> and <a href="../types/server.md#listexecutionsresponse">ListExecutionsResponse</a> type definitions.</p>
</blockquote>
<h3>Get Execution Details</h3>
<pre><code class="language-http">GET /api/pulse/executions/{execution_id}
</code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json">{
  "id": "PX_abc123_1733450123",
  "status": "completed",
  "started_at": "2025-12-06T02:00:00Z",
  "completed_at": "2025-12-06T02:00:12Z",
  "duration_ms": 12340,
  "logs": "[2025-12-06T02:00:00Z] Starting job\n[2025-12-06T02:00:12Z] Completed",
  "result_summary": "Processed successfully"
}
</code></pre>
<h3>Get Execution Logs</h3>
<pre><code class="language-http">GET /api/pulse/executions/{execution_id}/logs
</code></pre>
<p><strong>Response:</strong> Plain text logs</p>
<h2>Implementation</h2>
<h3>Ticker Integration</h3>
<p>Applications using Pulse should integrate execution tracking in their ticker:</p>
<pre><code class="language-go">// Create execution record before job runs
execution := &amp;models.PulseExecution{
    ID:             id.GenerateExecutionID(),
    ScheduledJobID: job.ID,
    Status:         "running",
    StartedAt:      time.Now().Format(time.RFC3339),
}
db.CreatePulseExecution(execution)

// Execute job
result, err := executeJob(job)

// Update execution with results
execution.CompletedAt = timePtr(time.Now())
execution.DurationMs = intPtr(durationMs)

if err != nil {
    execution.Status = "failed"
    execution.ErrorMessage = stringPtr(err.Error())
} else {
    execution.Status = "completed"
    execution.ResultSummary = stringPtr(result.Summary)
}

db.UpdatePulseExecution(execution)
</code></pre>
<h3>Storage Layer</h3>
<p><strong>Files:</strong></p>
<ul>
<li><code>internal/pulse/schedule/execution_store.go</code> - Execution persistence</li>
<li><code>internal/models/pulse_execution.go</code> - Execution model</li>
</ul>
<p><strong>Key Methods:</strong></p>
<ul>
<li><code>CreatePulseExecution(exec *PulseExecution) error</code></li>
<li><code>UpdatePulseExecution(exec *PulseExecution) error</code></li>
<li><code>GetPulseExecution(id string) (*PulseExecution, error)</code></li>
<li><code>ListPulseExecutions(jobID string, limit, offset int, status string) ([]*PulseExecution, int, error)</code></li>
</ul>
<h3>API Handlers</h3>
<p><strong>File:</strong> <code>internal/server/pulse_execution_handlers.go</code></p>
<p>Implements REST endpoints for:</p>
<ul>
<li>Listing executions with pagination and filtering</li>
<li>Getting execution details</li>
<li>Retrieving execution logs</li>
</ul>
<h2>Frontend Integration</h2>
<h3>TypeScript Types</h3>
<pre><code class="language-typescript">export type ExecutionStatus = "running" | "completed" | "failed";

export interface PulseExecution {
  id: string;
  scheduled_job_id: string;
  async_job_id?: string;
  status: ExecutionStatus;
  started_at: string;
  completed_at?: string;
  duration_ms?: number;
  result_summary?: string;
  error_message?: string;
}
</code></pre>
<h3>API Client</h3>
<pre><code class="language-typescript">export async function listExecutions(
  jobId: string,
  limit = 50,
  offset = 0,
  status?: ExecutionStatus
): Promise&lt;ListExecutionsResponse&gt;

export async function getExecutionLogs(
  executionId: string
): Promise&lt;string&gt;
</code></pre>
<h3>UI Components</h3>
<p><strong>Job Detail Panel</strong> - Displays execution history:</p>
<ul>
<li>Execution list with status badges</li>
<li>Duration tracking</li>
<li>Result summaries</li>
<li>Expandable log viewer</li>
</ul>
<p><strong>Styling:</strong></p>
<ul>
<li>Status color coding (running: purple, completed: green, failed: red)</li>
<li>Relative timestamps</li>
<li>Responsive pagination</li>
</ul>
<h2>Real-time Updates</h2>
<h3>WebSocket Messages</h3>
<p>Applications can broadcast execution status changes:</p>
<pre><code class="language-typescript">// Execution started
{
  "type": "pulse_execution_started",
  "execution_id": "PX_abc123",
  "job_id": "SPJ_123"
}

// Execution completed
{
  "type": "pulse_execution_completed",
  "execution_id": "PX_abc123",
  "job_id": "SPJ_123",
  "duration_ms": 12340
}

// Execution failed
{
  "type": "pulse_execution_failed",
  "execution_id": "PX_abc123",
  "job_id": "SPJ_123",
  "error": "Operation failed"
}
</code></pre>
<h2>Testing</h2>
<h3>Unit Tests</h3>
<ul>
<li>Execution store CRUD operations</li>
<li>API handler pagination and filtering</li>
<li>Ticker integration (execution record lifecycle)</li>
<li>Duration tracking accuracy</li>
<li>Error capture validation</li>
</ul>
<h3>Integration Tests</h3>
<ul>
<li>Complete job execution with history tracking</li>
<li>Failed execution error message capture</li>
<li>WebSocket broadcast verification</li>
<li>Log retrieval with large outputs</li>
</ul>
<h2>Future Enhancements</h2>
<ul>
<li><strong>Retention Policy</strong>: Auto-delete executions older than N days</li>
<li><strong>Execution Statistics</strong>: Success rate, average duration, trends</li>
<li><strong>Manual Re-run</strong>: Trigger immediate execution from history</li>
<li><strong>Export</strong>: Download execution history as CSV/JSON</li>
<li><strong>Alerting</strong>: Notifications on execution failures</li>
</ul>
<h2>Related Documentation</h2>
<ul>
<li><strong>Core Pulse Architecture</strong>: <a href="../architecture/pulse-async-ix.html"><code>pulse-async-ix.md</code></a></li>
<li><strong>Task Logging</strong>: <a href="task-logging.html"><code>task-logging.md</code></a> - Log capture mechanism</li>
<li><strong>Application Integration</strong>: See application-specific documentation for implementation examples</li>
</ul>
<footer class="site-footer">
  <p class="provenance">Generated by sitegen.nix at commit <a href="https://github.com/teranos/QNTX/commit/0e7ca38dd1dcce5d67e9797b91950b21353f137a-dirty">0e7ca38-dirty</a></p>
</footer>
</body>
</html>
