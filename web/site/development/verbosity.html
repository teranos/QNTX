<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QNTX - verbosity</title>
  <link rel="icon" type="image/jpeg" href="../qntx.jpg">
  <link rel="stylesheet" href="../css/core.css">
  <link rel="stylesheet" href="../css/docs.css">
</head>
<body>
<nav class="doc-nav">
  <a href="../index.html">
    <img src="../qntx.jpg" alt="QNTX" class="site-logo">Documentation Home
  </a>
</nav>
<h1>Verbosity Levels</h1>
<p><strong>Why progressive verbosity?</strong> Developers want different levels of detail at different times. Simple mental model: more v's = more info. LLMs can use higher verbosity for better context.</p>
<p>Progressive verbosity pattern for QNTX CLI commands using the <code>-v</code> flag.</p>
<h2>Pattern</h2>
<pre><code class="language-bash">qntx &lt;command&gt;        # Level 0 (default) - Results and errors only
qntx &lt;command&gt; -v     # Level 1 - Progress, startup, plugin status
qntx &lt;command&gt; -vv    # Level 2 - Queries, timing, config details
qntx &lt;command&gt; -vvv   # Level 3 - Plugin logs, SQL, gRPC calls
qntx &lt;command&gt; -vvvv  # Level 4 - Full request/response bodies
</code></pre>
<h2>Output Categories</h2>
<p>Verbosity controls <strong>what categories of output</strong> are shown, not just log severity. The system uses semantic output categories defined in <code>logger/output.go</code>.</p>
<h3>Category Reference</h3>
<table><thead><tr><th>Category</th><th>Level</th><th>Description</th></tr></thead><tbody>
<tr><td>Results, Errors</td><td>0</td><td>Final results and critical errors (always shown)</td></tr>
<tr><td>Progress</td><td>1</td><td>Startup messages, plugin status, progress updates</td></tr>
<tr><td>Ax AST</td><td>1</td><td>Parsed query AST for Ax queries</td></tr>
<tr><td>Plugin Status</td><td>1</td><td>Plugin load/unload notifications</td></tr>
<tr><td>Ax Matches</td><td>2</td><td>What attestations matched the query</td></tr>
<tr><td>Timing</td><td>2</td><td>Operation timing (opt-in, auto-shown if slow)</td></tr>
<tr><td>Config</td><td>2</td><td>Configuration details</td></tr>
<tr><td>Plugin Stdout</td><td>3</td><td>Standard output from plugins</td></tr>
<tr><td>Plugin Stderr</td><td>3</td><td>Standard error from plugins</td></tr>
<tr><td>SQL Queries</td><td>4</td><td>Raw SQL queries executed</td></tr>
<tr><td>gRPC Calls</td><td>4</td><td>gRPC method calls</td></tr>
<tr><td>Full Payloads</td><td>4</td><td>Complete request/response bodies</td></tr>
</tbody></table>
<h3>Special Behaviors</h3>
<h4>Timing with Slow Threshold</h4>
<p>Timing information has special handling via <code>logger.ShouldShowTiming()</code>:</p>
<ul>
<li>At <code>-vv</code> or higher: Always show timing</li>
<li>At any level: Auto-show if operation is slow (&gt;100ms)</li>
</ul>
<pre><code class="language-go">if logger.ShouldShowTiming(verbosity, durationMS) {
    fmt.Printf("Operation took %dms\n", durationMS)
}
</code></pre>
<h4>Zero Value Filtering</h4>
<p>Zero and default values add noise at lower verbosity levels. They're only shown at level 4 (<code>-vvvv</code>) where confirming "this is actually zero" matters for full data dumps.</p>
<p><strong>Filtered at levels 0-3:</strong></p>
<ul>
<li>Integer zeros: <code>count=0</code>, <code>total=0</code>, <code>group=0</code></li>
<li>Float zeros: <code>cost_estimate=0.0</code>, <code>cost_actual=0.0</code></li>
<li>Empty strings: <code>type=""</code>, <code>name=""</code></li>
<li>Default values: <code>type="untyped"</code>, <code>status="unknown"</code></li>
</ul>
<p><strong>Only shown at level 4:</strong>
All values including zeros for complete data dumps.</p>
<pre><code class="language-go">// Only log non-zero counts at lower verbosity
if count &gt; 0 || logger.ShouldShowZeroInt(verbosity) {
    log.Infow("Processed items", "count", count)
}

// Only log if value differs from default
if status != "unknown" || logger.ShouldShowDefaultValue(verbosity) {
    log.Infow("Status check", "status", status)
}
</code></pre>
<h4>Ax Query Output</h4>
<p>Ax queries have granular output control:</p>
<ul>
<li>Level 0: Final results only</li>
<li>Level 1: Parsed AST shown</li>
<li>Level 2: AST + matched attestations</li>
<li>Level 4: AST + matches + raw SQL query</li>
</ul>
<h2>Implementation</h2>
<h3>Checking Output Categories</h3>
<p>Use <code>logger.ShouldOutput()</code> to check if output should be shown:</p>
<pre><code class="language-go">import "github.com/teranos/QNTX/logger"

func executeQuery(verbosity int, query string) {
    // Level 1+: Show parsed AST
    if logger.ShouldOutput(verbosity, logger.OutputAxAST) {
        fmt.Printf("Parsed AST: %v\n", ast)
    }

    // Level 2+: Show what matched
    if logger.ShouldOutput(verbosity, logger.OutputAxMatches) {
        fmt.Printf("Matched %d attestations\n", len(matches))
    }

    // Level 4+: Show raw SQL
    if logger.ShouldOutput(verbosity, logger.OutputSQLQueries) {
        fmt.Printf("SQL: %s\n", sqlQuery)
    }
}
</code></pre>
<h3>Logger Level Mapping</h3>
<p>Verbosity also maps to zap log levels via <code>logger.VerbosityToLevel()</code>:</p>
<table><thead><tr><th>Verbosity</th><th>Log Level</th></tr></thead><tbody>
<tr><td>0 (none)</td><td>WarnLevel</td></tr>
<tr><td>1 (-v)</td><td>InfoLevel</td></tr>
<tr><td>2+ (-vv)</td><td>DebugLevel</td></tr>
</tbody></table>
<h3>Symbol-Aware Logging</h3>
<p>Use structured symbol logging instead of embedding symbols in messages:</p>
<pre><code class="language-go">// Instead of:
logger.Infow(sym.Pulse + " Job started", "job_id", id)

// Use:
logger.PulseInfow("Job started", "job_id", id)

// Or with instance loggers:
pulseLog := logger.AddPulseSymbol(s.logger)
pulseLog.Infow("Job started", "job_id", id)
</code></pre>
<p>This keeps log messages clean and makes symbols queryable as structured fields.</p>
<h2>Level Definitions</h2>
<h3>Level 0 (Default)</h3>
<p>Clean, user-facing output only:</p>
<ul>
<li>Final results</li>
<li>Critical errors</li>
<li>Essential progress messages</li>
</ul>
<p>Hides parsing details, internal processing, SQL queries, and debug information.</p>
<h3>Level 1 (<code>-v</code>)</h3>
<p>Progress and status information:</p>
<ul>
<li>Startup/shutdown events</li>
<li>Plugin status changes</li>
<li>Parsed query AST</li>
<li>Warnings that don't stop execution</li>
</ul>
<h3>Level 2 (<code>-vv</code>)</h3>
<p>Debug information for troubleshooting:</p>
<ul>
<li>Matched attestations for Ax queries</li>
<li>Operation timing (plus auto-show for slow &gt;100ms)</li>
<li>Configuration details</li>
<li>Full result sets</li>
</ul>
<h3>Level 3 (<code>-vvv</code>)</h3>
<p>Deep debugging context:</p>
<ul>
<li>Plugin stdout/stderr logs</li>
<li>Full error details</li>
<li>Stack traces</li>
<li>Internal state inspection</li>
</ul>
<h3>Level 4 (<code>-vvvv</code>)</h3>
<p>Ultra-verbose troubleshooting:</p>
<ul>
<li>Raw SQL queries</li>
<li>gRPC method calls and timing</li>
<li>Full request/response bodies</li>
<li>All subsystem-specific debugging</li>
</ul>
<h2>ax Command Examples</h2>
<h3>Level 0 (Default)</h3>
<pre><code>Subject: "user_123"
Predicate: "has_skill"
Object: "Go"

1 attestation found
</code></pre>
<h3>Level 1 (<code>-v</code>)</h3>
<pre><code>Parsing query...
  Subject: "user_123"
  Predicate: "has_skill"
  Object: "Go"
  Context: (none)

Executing query...
Found 1 matching attestation

Results:
  [attestation details...]
</code></pre>
<h3>Level 2 (<code>-vv</code>)</h3>
<pre><code>Parsing query...
  Subject: "user_123"
  Predicate: "has_skill"
  Object: "Go"

Matched attestations:
  - ats_123abc... (created 2024-01-15)

Execution time: 2.3ms

Results with full context:
  [Complete attestation data with metadata...]
</code></pre>
<h3>Level 4 (<code>-vvvv</code>)</h3>
<pre><code>[All Level 2 output plus:]

SQL: SELECT * FROM attestations WHERE subject = ? AND predicate = ? AND object = ?
Parameters: ["user_123", "has_skill", "Go"]
</code></pre>
<h2>Implementation Notes</h2>
<p>The verbosity flag is defined globally in the root command and available to all subcommands. Commands interpret levels based on their specific needs while following the general pattern above.</p>
<p>See <code>logger/output.go</code> for the complete list of output categories and their verbosity requirements.</p>
<footer class="site-footer">
  <p class="provenance">Generated by sitegen.nix at commit <a href="https://github.com/teranos/QNTX/commit/0e7ca38dd1dcce5d67e9797b91950b21353f137a-dirty">0e7ca38-dirty</a></p>
</footer>
</body>
</html>
