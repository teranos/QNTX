# Implement True Glyph Morphing System

## Summary
- Implements the glyph morphing system as specified in the vision document
- Enforces the single DOM element axiom - each glyph is exactly ONE DOM element for its entire lifetime
- Enables smooth transitions between all three states: dot (8px) ↔ proximity expanded (220px) ↔ window

## Key Changes

### Architecture
- Renamed window-tray → glyph-run throughout for clarity
- Extracted proximity morphing logic into `glyph-proximity.ts` module
- Extracted window morphing logic into `glyph-morph.ts` module
- Centralized glyph element factory in `glyph-run.ts` to enforce single-element axiom

### Animation Fixes
- Fixed maximize animation from proximity expanded state to window
- Fixed minimize animation to be smooth and visible (window → dot)
- Proper browser paint sequencing with setTimeout(0) and requestAnimationFrame
- Removed CSS transitions that interfered with JS-controlled animations
- Configurable animation durations (200ms for both maximize and minimize)

### Functionality
- Window position memory - windows restore to their last position
- Fixed windowState flag persistence preventing second clicks
- Fixed window dragging lag by removing lingering transitions
- Fixed title bar positioning with proper flex layout
- Fixed text lingering after minimize by clearing content and dataset flags

### Structural Invariants
The implementation strictly enforces:
- **AXIOM**: A Glyph is exactly ONE DOM element for its entire lifetime
- **FORBIDDEN**: cloneNode, createElement for existing glyphs, re-rendering, duplicates
- **ALLOWED**: Reparenting, style changes, position transforms, delayed content mount

This is not a UX preference but a structural requirement for future attestations and reasoning about glyph state and relationships.

## Testing
Manually verified:
- Smooth transitions between all states
- Click to open from dot and proximity expanded states
- Minimize button functionality
- Window dragging without lag
- Position memory across minimize/restore cycles
- No duplicate elements or axiom violations

## Files Changed
- `docs/vision/glyph.md` - Added state persistence and positioning sections
- `web/ts/components/glyph-run.ts` - Main orchestrator with element factory
- `web/ts/components/glyph-proximity.ts` - Proximity morphing module (new)
- `web/ts/components/glyph-morph.ts` - Window morphing module (new)
- `web/css/glyph-run.css` - Renamed classes and removed interfering transitions
- Various integration updates in window.ts and main.ts